<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>‘x walrus z’: when and why should you use assignment expressions? | import-this</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="‘x walrus z’: when and why should you use assignment expressions?" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Assignment expressions, also known as the walrus operator (x := z) was a proposal in PEP 572 by . The expression above is pronounced “x walrus z”, and it allows you to assign values to variables as part of larger expressions where, before Python 3.8, you previously could not (we will get into this in detail later). By the way, it’s called the walrus operator because it looks like the eyes and tusks of a walrus" />
<meta property="og:description" content="Assignment expressions, also known as the walrus operator (x := z) was a proposal in PEP 572 by . The expression above is pronounced “x walrus z”, and it allows you to assign values to variables as part of larger expressions where, before Python 3.8, you previously could not (we will get into this in detail later). By the way, it’s called the walrus operator because it looks like the eyes and tusks of a walrus" />
<link rel="canonical" href="/import-this/2021/02/13/when-and-how-to-use-assignment-expressions.html" />
<meta property="og:url" content="/import-this/2021/02/13/when-and-how-to-use-assignment-expressions.html" />
<meta property="og:site_name" content="import-this" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-02-13T10:26:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="‘x walrus z’: when and why should you use assignment expressions?" />
<script type="application/ld+json">
{"url":"/import-this/2021/02/13/when-and-how-to-use-assignment-expressions.html","headline":"‘x walrus z’: when and why should you use assignment expressions?","datePublished":"2021-02-13T10:26:00-05:00","dateModified":"2021-02-13T10:26:00-05:00","description":"Assignment expressions, also known as the walrus operator (x := z) was a proposal in PEP 572 by . The expression above is pronounced “x walrus z”, and it allows you to assign values to variables as part of larger expressions where, before Python 3.8, you previously could not (we will get into this in detail later). By the way, it’s called the walrus operator because it looks like the eyes and tusks of a walrus","mainEntityOfPage":{"@type":"WebPage","@id":"/import-this/2021/02/13/when-and-how-to-use-assignment-expressions.html"},"@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/import-this/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/import-this/feed.xml" title="import-this" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/import-this/">import-this</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/import-this/about.html">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">&#39;x walrus z&#39;: when and why should you use assignment expressions?</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2021-02-13T10:26:00-05:00" itemprop="datePublished">Feb 13, 2021
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Assignment expressions, also known as the walrus operator (<code class="language-plaintext highlighter-rouge">x := z</code>) was a proposal in <a href="https://www.python.org/dev/peps/pep-0572/" target="_blank">PEP 572</a> by . The expression above is pronounced “<em>x walrus z</em>”, and it allows you to assign values to variables as part of larger expressions where, before Python 3.8, you previously could not (we will get into this in detail later). By the way, it’s called the walrus operator because it looks like the eyes and tusks of a <a href="https://en.wikipedia.org/wiki/Walrus#/media/File:Pacific_Walrus_-_Bull_(8247646168).jpg" target="_blank">walrus</a></p>

<p>At the time, the walrus operator was met with a lot of controversy. During the proposal of the walrus operator in PEP 572, some people argued that assignment expressions were bad and not Pythonic. These people really pushed back and claimed that <em>they</em> knew what was Pythonic and what was not. “Assignment expressions are NOT pythonic!” they exclaimed loudly.</p>

<p>When PEP 572 was proposed, Guido Van Rossum was the BDFL (Benevolent Dictator For Life) of Python. And he disagreed with them. He believed that the walrus operator was a good addition and that it was, in fact, very Pythonic. He ought to know… He created the language after all. Guido went ahead and approved PEP 572, including the walrus operator.</p>

<p>But by then the oppinions of the contributing Python developers had added a lot of stress and difficulty to his life. He knew this was not the first time he had faced such opposition, and certaintly not the last time either. He decided it was time to let others handle the job. Guido promptly stepped down as Pythons BDFL the very next morning.</p>

<p>This makes the walrus operator one of the most interesting and important PEP proposals in Pythons history. So let’s look into assignment expressions and make our own conclusion: was Guido right? Or was his opposition right? Is the walrus operator any good?</p>

<p>As previously stated, the walrus operator allows the developer to assign values to variables in places where assignment were previously not allowed. The most common being within an <code class="language-plaintext highlighter-rouge">if</code> statement. Let’s look at some common patterns and use cases which could benefit from the walrus operator. The first common pattern involves any circumstance we need to read from a variable, check if its value is non-zero, and then use that value. Let’s pretend we work at a burrito shop and we are serving customers. First, let’s initialize the current stock of our different burritos:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">burrito_stock</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">'beef'</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="s">'chicken'</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
    <span class="s">'black_bean'</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
    <span class="s">'veggie'</span><span class="p">:</span> <span class="mi">27</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Let’s say a customer comes in and wants to buy a beef burrito. First, we need to check if we have a beef burrito to sell, and if we do, we can check out her/his order. We could do this by getting count of our current stock of beef burritos and then checking for a non-zero value with an <code class="language-plaintext highlighter-rouge">if</code> statement:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">make_beef_burrito</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
    <span class="p">...</span>
<span class="k">def</span> <span class="nf">out_of_stock</span><span class="p">():</span>
    <span class="p">...</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">burrito_stock</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'beef'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">if</span> <span class="n">count</span><span class="p">:</span>
    <span class="n">make_beef_burrito</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">out_of_stock</span><span class="p">()</span>

</code></pre></div></div>
<p>We can see this code may be misleading because it’s easy to assume that the count variable is accessed in both the <code class="language-plaintext highlighter-rouge">if</code> and <code class="language-plaintext highlighter-rouge">else</code> branches. Because count is declared at the top, but is only accessed in the <code class="language-plaintext highlighter-rouge">if</code> branch, we might mistake it for being more important than it actually is.</p>

<p>Assignment expressions make this exact scenario cleaner. Here is the same example with the walrus operator:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">count</span> <span class="p">:</span><span class="o">=</span> <span class="n">burrito_stock</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'beef'</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
    <span class="n">make_beef_burrito</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">out_of_stock</span><span class="p">()</span>

</code></pre></div></div>
<p>Now it becomes very clear where the count variable is being used. It is more obvious at a glance that count is relevant to the <code class="language-plaintext highlighter-rouge">if</code> branch. This two step process of assigning and then evaluating is the core concept behind the walrus operator.</p>

<p>If we continue with this scenario, but instead of simply doing a non-zero check, we let the customer order multiple beef burritos, say 3, we now need to do a comparison inside the <code class="language-plaintext highlighter-rouge">if</code> statement. Without the walrus operator, that would look like this:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">size_order</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">count</span> <span class="o">=</span> <span class="n">burrito_stock</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'beef'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="k">if</span> <span class="n">count</span> <span class="o">&gt;=</span> <span class="n">size_order</span><span class="p">:</span>
    <span class="n">make_beef_burrito</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">out_of_stock</span><span class="p">()</span>

</code></pre></div></div>
<p>This still presents the same problem of over emphasizing the count variable. We can clean this up again by making it clear where count is important with the walrus operator:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">size_order</span> <span class="o">=</span> <span class="mi">3</span>
<span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="p">:</span><span class="o">=</span> <span class="n">burrito_stock</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'beef'</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">size_order</span><span class="p">:</span>
    <span class="n">make_beef_burrito</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">out_of_stock</span><span class="p">()</span>

</code></pre></div></div>
<p>It is important to note that when our assignment expression is a subexpression of a larger expression, like above, we need to wrap it in parentheses.</p>

<p>One caveat, mentioned by Python core developer Raymond Hettinger in the docs <a href="https://docs.python.org/3/whatsnew/3.8.html" target="_blank">‘What’s New in Python 3.8’</a>, is that we should:</p>
<blockquote>
  <p>Try to limit use of the walrus operator to clean cases that reduce complexity and improve readability.</p>
</blockquote>

<p>So don’t go wild with the walrus. Be sensible. Be Pythonic.</p>

  </div><a class="u-url" href="/import-this/2021/02/13/when-and-how-to-use-assignment-expressions.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/import-this/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">import-this</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">import-this</li><li><a class="u-email" href="mailto:nicholashopewell@gmail.com">nicholashopewell@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/NHopewell"><svg class="svg-icon"><use xlink:href="/import-this/assets/minima-social-icons.svg#github"></use></svg> <span class="username">NHopewell</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>I talk about Python. 🐍 </p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
